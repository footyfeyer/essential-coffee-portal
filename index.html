<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Essential Coffee Portal</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 2rem;
      background: #fdfcf9;
      color: #333;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>New Teton Roast Club Portal</h1>

    <!-- PayPal Button Container -->
    <div id="paypal-button-container"></div>
  </div>
  
  <!-- Inject user context for checkout personalization -->
<script src="/inject-context.js"></script>

  <!-- PayPal SDK + Button Logic -->
  <script src="https://www.paypal.com/sdk/js?client-id=AT_xxoz-PYLFSonJbhWz0Uf44qImA62UPvKxPUPaopu97NzXLX5ePfxoELjFFnxkQcW4aGMKcGgR1Hqo&currency=USD"></script>
  
  
  <script>
         
    paypal.Buttons({
      createOrder: function(data, actions) {
        const ctx = window.userContext || {};
    
        // üß™ Log full context for traceability
        console.log("üß™ Creating PayPal order with context:", ctx);
    
        // üõ°Ô∏è Validate context before proceeding
        if (!ctx.email || !ctx.zip) {
          console.warn("‚ö†Ô∏è Missing required context. Aborting order creation.");
          alert("Missing user info. Please refresh or contact support.");
          return;
        }
    
        // üßæ Generate invoice ID for internal mapping
        const invoiceId = `sub-${ctx.email}-${Date.now()}`;
    
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: "22.00"
            },
            description: `Email: ${ctx.email}, Zip: ${ctx.zip}, Pickup: ${ctx.pickup ? "Yes" : "No"}`,
            custom_id: ctx.email,
            invoice_id: invoiceId
          }]
        });
      },
    
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          console.log("‚úÖ Payment captured:", details);
        });
      }
    }).render("#paypal-button-container");
    
     
  </script>
  
  
  
  <script>
  const userContext = window.userContext || {};
  console.log("üîç Dev Context Check:", {
    email: userContext.email,
    zip: userContext.zip,
    pickup: userContext.pickup,
  });
</script>

</body>

</html>
